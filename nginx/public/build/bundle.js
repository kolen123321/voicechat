var app=function(){"use strict";function e(){}function t(e){return e()}function n(){return Object.create(null)}function o(e){e.forEach(t)}function r(e){return"function"==typeof e}function i(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}let s,c;function u(e,t){return s||(s=document.createElement("a")),s.href=t,e===s.href}function a(t,...n){if(null==t)return e;const o=t.subscribe(...n);return o.unsubscribe?()=>o.unsubscribe():o}function l(e,t,n){e.$$.on_destroy.push(a(t,n))}function d(e,t){e.appendChild(t)}function p(e,t,n){e.insertBefore(t,n||null)}function f(e){e.parentNode.removeChild(e)}function m(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function g(e){return document.createElement(e)}function h(e){return document.createTextNode(e)}function x(){return h(" ")}function y(){return h("")}function w(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function b(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function v(e,t){t=""+t,e.wholeText!==t&&(e.data=t)}function $(e,t){e.value=null==t?"":t}function k(e,t,n,o){null===n?e.style.removeProperty(t):e.style.setProperty(t,n,o?"important":"")}function _(e){c=e}function O(e){(function(){if(!c)throw new Error("Function called outside component initialization");return c})().$$.on_mount.push(e)}const S=[],D=[],E=[],M=[],N=Promise.resolve();let T=!1;function j(e){E.push(e)}const C=new Set;let J=0;function P(){const e=c;do{for(;J<S.length;){const e=S[J];J++,_(e),L(e.$$)}for(_(null),S.length=0,J=0;D.length;)D.pop()();for(let e=0;e<E.length;e+=1){const t=E[e];C.has(t)||(C.add(t),t())}E.length=0}while(S.length);for(;M.length;)M.pop()();T=!1,C.clear(),_(e)}function L(e){if(null!==e.fragment){e.update(),o(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(j)}}const I=new Set;let A;function R(){A={r:0,c:[],p:A}}function F(){A.r||o(A.c),A=A.p}function z(e,t){e&&e.i&&(I.delete(e),e.i(t))}function B(e,t,n,o){if(e&&e.o){if(I.has(e))return;I.add(e),A.c.push((()=>{I.delete(e),o&&(n&&e.d(1),o())})),e.o(t)}}function H(e){e&&e.c()}function q(e,n,i,s){const{fragment:c,on_mount:u,on_destroy:a,after_update:l}=e.$$;c&&c.m(n,i),s||j((()=>{const n=u.map(t).filter(r);a?a.push(...n):o(n),e.$$.on_mount=[]})),l.forEach(j)}function G(e,t){const n=e.$$;null!==n.fragment&&(o(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function U(e,t){-1===e.$$.dirty[0]&&(S.push(e),T||(T=!0,N.then(P)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function W(t,r,i,s,u,a,l,d=[-1]){const p=c;_(t);const m=t.$$={fragment:null,ctx:null,props:a,update:e,not_equal:u,bound:n(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(r.context||(p?p.$$.context:[])),callbacks:n(),dirty:d,skip_bound:!1,root:r.target||p.$$.root};l&&l(m.root);let g=!1;if(m.ctx=i?i(t,r.props||{},((e,n,...o)=>{const r=o.length?o[0]:n;return m.ctx&&u(m.ctx[e],m.ctx[e]=r)&&(!m.skip_bound&&m.bound[e]&&m.bound[e](r),g&&U(t,e)),n})):[],m.update(),g=!0,o(m.before_update),m.fragment=!!s&&s(m.ctx),r.target){if(r.hydrate){const e=function(e){return Array.from(e.childNodes)}(r.target);m.fragment&&m.fragment.l(e),e.forEach(f)}else m.fragment&&m.fragment.c();r.intro&&z(t.$$.fragment),q(t,r.target,r.anchor,r.customElement),P()}_(p)}class X{$destroy(){G(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const K=[];function Q(t,n=e){let o;const r=new Set;function s(e){if(i(t,e)&&(t=e,o)){const e=!K.length;for(const e of r)e[1](),K.push(e,t);if(e){for(let e=0;e<K.length;e+=2)K[e][0](K[e+1]);K.length=0}}}return{set:s,update:function(e){s(e(t))},subscribe:function(i,c=e){const u=[i,c];return r.add(u),1===r.size&&(o=n(s)||e),i(t),()=>{r.delete(u),0===r.size&&(o(),o=null)}}}}function V(e,t,n){const o=e.slice();return o[26]=t[n],o}function Y(e,t,n){const o=e.slice();return o[29]=t[n],o}function Z(e){let t,n,r,i;return{c(){t=g("div"),n=g("input"),b(n,"type","range"),b(n,"min","0"),b(n,"max","100"),b(t,"class","text-[#fff] p-[15px] bg-[#212124] border-[1px] border-[#101010] absolute right-[0px] top-[-60px] rounded-[5px] flex flex-col gap-[15px]")},m(o,s){p(o,t,s),d(t,n),$(n,e[8]),r||(i=[w(n,"change",e[17]),w(n,"input",e[17]),w(t,"click",ie)],r=!0)},p(e,t){256&t[0]&&$(n,e[8])},d(e){e&&f(t),r=!1,o(i)}}}function ee(e){let t,n,o,r=e[0],i=[];for(let t=0;t<r.length;t+=1)i[t]=te(Y(e,r,t));return{c(){t=g("div");for(let e=0;e<i.length;e+=1)i[e].c();b(t,"class","text-[#fff] p-[15px] bg-[#212124] border-[1px] border-[#101010] absolute right-[5px] bottom-[40px] rounded-[5px] flex flex-col gap-[15px]")},m(e,r){p(e,t,r);for(let e=0;e<i.length;e+=1)i[e].m(t,null);n||(o=w(t,"click",se),n=!0)},p(e,n){if(1027&n[0]){let o;for(r=e[0],o=0;o<r.length;o+=1){const s=Y(e,r,o);i[o]?i[o].p(s,n):(i[o]=te(s),i[o].c(),i[o].m(t,null))}for(;o<i.length;o+=1)i[o].d(1);i.length=r.length}},d(e){e&&f(t),m(i,e),n=!1,o()}}}function te(e){let t,n,o,r,i,s,c=e[29].label+"",u=e[29].deviceId==e[10].deviceId?" (selected)":"";function a(...t){return e[20](e[29],...t)}return{c(){t=g("span"),n=h(c),o=x(),r=h(u),b(t,"class","cursor-pointer"),k(t,"white-space","nowrap")},m(e,c){p(e,t,c),d(t,n),d(t,o),d(t,r),i||(s=w(t,"click",a),i=!0)},p(t,o){e=t,1&o[0]&&c!==(c=e[29].label+"")&&v(n,c),1025&o[0]&&u!==(u=e[29].deviceId==e[10].deviceId?" (selected)":"")&&v(r,u)},d(e){e&&f(t),i=!1,s()}}}function ne(e){let t,n,o,r=e[3],i=[];for(let t=0;t<r.length;t+=1)i[t]=oe(V(e,r,t));return{c(){t=g("div");for(let e=0;e<i.length;e+=1)i[e].c();b(t,"class","text-[#fff] p-[15px] bg-[#212124] border-[1px] border-[#101010] absolute right-[5px] bottom-[40px] rounded-[5px] flex flex-col gap-[15px]")},m(e,r){p(e,t,r);for(let e=0;e<i.length;e+=1)i[e].m(t,null);n||(o=w(t,"click",ce),n=!0)},p(e,n){if(4108&n[0]){let o;for(r=e[3],o=0;o<r.length;o+=1){const s=V(e,r,o);i[o]?i[o].p(s,n):(i[o]=oe(s),i[o].c(),i[o].m(t,null))}for(;o<i.length;o+=1)i[o].d(1);i.length=r.length}},d(e){e&&f(t),m(i,e),n=!1,o()}}}function oe(e){let t,n,o,r,i,s,c=e[26].label+"",u=e[26].deviceId==e[12].deviceId?" (selected)":"";function a(...t){return e[23](e[26],...t)}return{c(){t=g("span"),n=h(c),o=x(),r=h(u),b(t,"class","cursor-pointer"),k(t,"white-space","nowrap")},m(e,c){p(e,t,c),d(t,n),d(t,o),d(t,r),i||(s=w(t,"click",a),i=!0)},p(t,o){e=t,8&o[0]&&c!==(c=e[26].label+"")&&v(n,c),4104&o[0]&&u!==(u=e[26].deviceId==e[12].deviceId?" (selected)":"")&&v(r,u)},d(e){e&&f(t),i=!1,s()}}}function re(t){let n,r,i,s,c,a,l,m,h,y,v,$,_,O,S,D,E,M,N,T,j,C,J,P=t[7].volume&&Z(t),L=t[7].micro&&ee(t),I=t[7].output&&ne(t);return{c(){n=g("div"),r=g("div"),i=g("img"),c=x(),P&&P.c(),a=x(),l=g("div"),m=g("img"),y=x(),v=g("div"),v.innerHTML='<img src="/images/arrow.png" alt=""/>',$=x(),L&&L.c(),O=x(),S=g("div"),D=g("img"),M=x(),N=g("div"),N.innerHTML='<img src="/images/arrow.png" alt=""/>',T=x(),I&&I.c(),u(i.src,s="/images/volume.png")||b(i,"src","/images/volume.png"),b(i,"alt",""),b(r,"class","h-[90px] relative w-[90px] cursor-pointer flex items-center justify-center bg-[#2F3136] rounded-[100%]"),u(m.src,h="/images/microphone.png")||b(m,"src","/images/microphone.png"),b(m,"alt",""),b(v,"class","flex justify-center bg-[#2F3136] rounded-[100%] items-center w-[35px] h-[35px] bottom-0 right-0 absolute"),k(v,"border","5px solid #18191C"),k(v,"border-radius","100px"),b(l,"class",_="h-[90px] w-[90px] cursor-pointer flex items-center justify-center "+(t[9]?"bg-[#ed4245]":"bg-[#2F3136]")+" rounded-[100%] relative"),u(D.src,E="/images/headphones.png")||b(D,"src","/images/headphones.png"),b(D,"alt",""),b(N,"class","flex justify-center bg-[#2F3136] rounded-[100%] items-center w-[35px] h-[35px] bottom-0 right-0 absolute"),k(N,"border","5px solid #18191C"),k(N,"border-radius","100px"),b(S,"class","h-[90px] w-[90px] cursor-pointer flex items-center justify-center rounded-[100%] relative"),b(S,"style",j=t[11]?"background: #ed4245;":"background: #2F3136;"),b(n,"class","flex gap-[66px] justify-center items-center mt-[75px] w-full h-[100px]"),k(n,"margin-top","auto"),k(n,"margin-bottom","50px")},m(e,o){p(e,n,o),d(n,r),d(r,i),d(r,c),P&&P.m(r,null),d(n,a),d(n,l),d(l,m),d(l,y),d(l,v),d(l,$),L&&L.m(l,null),d(n,O),d(n,S),d(S,D),d(S,M),d(S,N),d(S,T),I&&I.m(S,null),C||(J=[w(r,"click",t[18]),w(v,"click",t[19]),w(l,"click",t[21]),w(N,"click",t[22]),w(S,"click",t[24])],C=!0)},p(e,t){e[7].volume?P?P.p(e,t):(P=Z(e),P.c(),P.m(r,null)):P&&(P.d(1),P=null),e[7].micro?L?L.p(e,t):(L=ee(e),L.c(),L.m(l,null)):L&&(L.d(1),L=null),512&t[0]&&_!==(_="h-[90px] w-[90px] cursor-pointer flex items-center justify-center "+(e[9]?"bg-[#ed4245]":"bg-[#2F3136]")+" rounded-[100%] relative")&&b(l,"class",_),e[7].output?I?I.p(e,t):(I=ne(e),I.c(),I.m(S,null)):I&&(I.d(1),I=null),2048&t[0]&&j!==(j=e[11]?"background: #ed4245;":"background: #2F3136;")&&b(S,"style",j)},i:e,o:e,d(e){e&&f(n),P&&P.d(),L&&L.d(),I&&I.d(),C=!1,o(J)}}}const ie=e=>{e.stopPropagation()},se=e=>{e.stopPropagation()},ce=e=>{e.stopPropagation()};function ue(t,n,o){let r,i,s,c,u,d,p=e,f=()=>(p(),p=a(M,(e=>o(25,r=e))),M),m=e,g=()=>(m(),m=a(E,(e=>o(9,s=e))),E),h=e,x=()=>(h(),h=a(k,(e=>o(10,c=e))),k),y=e,w=()=>(y(),y=a(N,(e=>o(11,u=e))),N),b=e,v=()=>(b(),b=a(O,(e=>o(12,d=e))),O);t.$$.on_destroy.push((()=>p())),t.$$.on_destroy.push((()=>m())),t.$$.on_destroy.push((()=>h())),t.$$.on_destroy.push((()=>y())),t.$$.on_destroy.push((()=>b()));let{microphones:$,selectedMicrophone:k,stream:_,selectedOutput:O,outputs:S,volume:D,muted:E,players:M,mutedOutput:N,websockets:T}=n;x(),v(),g(),f(),w(),E.subscribe((e=>{_&&(_.getAudioTracks()[0].enabled=!e,T.voice&&T.voice.send(JSON.stringify({type:"change_state",states:{mute:e}})),r.forEach((t=>{let n=t.stream;const o=t.hearing;n.getTracks()[0].enabled=0!=o&&!e})))})),N.subscribe((e=>{let t=new Event("output."+(e?"mute":"unmute"));T.voice&&T.voice.send(JSON.stringify({type:"change_state",states:{deaf:e}})),window.dispatchEvent(t)}));let j=Q(100);l(t,j,(e=>o(8,i=e))),j.subscribe((e=>{D.set(e/100)}));let C={micro:!1,output:!1,volume:!1};window.addEventListener("click",(e=>{o(7,C={micro:!1,output:!1,volume:!1})}));return t.$$set=e=>{"microphones"in e&&o(0,$=e.microphones),"selectedMicrophone"in e&&x(o(1,k=e.selectedMicrophone)),"stream"in e&&o(14,_=e.stream),"selectedOutput"in e&&v(o(2,O=e.selectedOutput)),"outputs"in e&&o(3,S=e.outputs),"volume"in e&&o(15,D=e.volume),"muted"in e&&g(o(4,E=e.muted)),"players"in e&&f(o(5,M=e.players)),"mutedOutput"in e&&w(o(6,N=e.mutedOutput)),"websockets"in e&&o(16,T=e.websockets)},[$,k,O,S,E,M,N,C,i,s,c,u,d,j,_,D,T,function(){var e;e=this.value,i=""===e?null:+e,j.set(i)},e=>{e.stopPropagation(),o(7,C.volume=!C.volume,C)},e=>{e.stopPropagation(),o(7,C.micro=!C.micro,C)},(e,t)=>{t.stopPropagation(),k.set(e)},()=>E.set(!s),e=>{e.stopPropagation(),o(7,C.output=!C.output,C)},(e,t)=>{t.stopPropagation(),O.set(e)},()=>N.set(!u)]}class ae extends X{constructor(e){super(),W(this,e,ue,re,i,{microphones:0,selectedMicrophone:1,stream:14,selectedOutput:2,outputs:3,volume:15,muted:4,players:5,mutedOutput:6,websockets:16},null,[-1,-1])}}function le(t){let n;return{c(){n=g("audio"),n.autoplay=!0},m(e,o){p(e,n,o),t[14](n)},p:e,d(e){e&&f(n),t[14](null)}}}function de(e){let t,n=e[0].uuid&&pe(e);return{c(){n&&n.c(),t=y()},m(e,o){n&&n.m(e,o),p(e,t,o)},p(e,o){e[0].uuid?n?n.p(e,o):(n=pe(e),n.c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(e){n&&n.d(e),e&&f(t)}}}function pe(e){let t,n,o,r,i,s,c,a=(e[0].mute||e[1].mute)&&fe(),l=(e[0].deaf||e[1].deaf)&&me();return{c(){t=g("div"),n=g("div"),a&&a.c(),o=x(),l&&l.c(),r=x(),i=g("img"),b(n,"class","flex gap-[5px] items-center absolute bottom-[-15px] right-[-15px]"),k(n,"width","fit-content"),u(i.src,s="https://crafatar.com/avatars/"+e[0].uuid)||b(i,"src",s),b(i,"class","rounded-[20px]"),b(i,"style",c="z-index: 100; "+(e[5]?"outline: 4px solid #3BA55D;":"")),b(i,"alt",""),b(t,"class","relative")},m(e,s){p(e,t,s),d(t,n),a&&a.m(n,null),d(n,o),l&&l.m(n,null),d(t,r),d(t,i)},p(e,t){e[0].mute||e[1].mute?a||(a=fe(),a.c(),a.m(n,o)):a&&(a.d(1),a=null),e[0].deaf||e[1].deaf?l||(l=me(),l.c(),l.m(n,null)):l&&(l.d(1),l=null),1&t&&!u(i.src,s="https://crafatar.com/avatars/"+e[0].uuid)&&b(i,"src",s),32&t&&c!==(c="z-index: 100; "+(e[5]?"outline: 4px solid #3BA55D;":""))&&b(i,"style",c)},d(e){e&&f(t),a&&a.d(),l&&l.d()}}}function fe(e){let t;return{c(){t=g("div"),t.innerHTML='<img src="/images/microphone.png" width="20" style="z-index: 999;" alt=""/>',b(t,"class","bg-[#ed4245] w-[30px] h-[30px] flex items-center justify-center rounded-[100px]")},m(e,n){p(e,t,n)},d(e){e&&f(t)}}}function me(e){let t;return{c(){t=g("div"),t.innerHTML='<img src="/images/headphones.png" width="22" style="z-index: 999;" alt=""/>',b(t,"class","bg-[#ed4245] w-[30px] h-[30px] flex items-center justify-center rounded-[100px]")},m(e,n){p(e,t,n)},d(e){e&&f(t)}}}function ge(t){let n,o,r=t[0].uuid!=t[1].uuid&&le(t),i=(t[0]&&t[0].hearing||t[0].uuid==t[1].uuid)&&de(t);return{c(){r&&r.c(),n=x(),i&&i.c(),o=y()},m(e,t){r&&r.m(e,t),p(e,n,t),i&&i.m(e,t),p(e,o,t)},p(e,[t]){e[0].uuid!=e[1].uuid?r?r.p(e,t):(r=le(e),r.c(),r.m(n.parentNode,n)):r&&(r.d(1),r=null),e[0]&&e[0].hearing||e[0].uuid==e[1].uuid?i?i.p(e,t):(i=de(e),i.c(),i.m(o.parentNode,o)):i&&(i.d(1),i=null)},i:e,o:e,d(e){r&&r.d(e),e&&f(n),i&&i.d(e),e&&f(o)}}}function he(t,n,o){let r,i,s=e,c=()=>(s(),s=a(y,(e=>o(12,r=e))),y),u=e,l=()=>(u(),u=a(w,(e=>o(13,i=e))),w);t.$$.on_destroy.push((()=>s())),t.$$.on_destroy.push((()=>u()));let d,p,f,{peer:m,player:g,me:h={},selectedOutput:x=null,volume:y,mutedOutput:w,hearingDistance:b}=n;c(),l();let v,$=!1,k=!0;function _(e){let t=e.inputBuffer.getChannelData(0),n=t.length,r=0;for(let e=0;e<n;e++)r+=Math.abs(t[e++]);o(9,p=100*Math.sqrt(r/n)),p>1.5&&h.websockets&&h.websockets.voice&&h.websockets.voice.readyState?(o(5,$=!0),k=!1,h.websockets.voice.send(JSON.stringify({type:"act_start"})),setTimeout((()=>k=!0),1e3)):$&&k&&(o(5,$=!1),h.websockets.voice.send(JSON.stringify({type:"act_stop"})))}return x&&x.subscribe((e=>{d&&d.setSinkId(e.deviceId)})),O((async()=>{h.uuid!=g.uuid&&await async function(){o(10,f=m.remoteStream),o(4,d.srcObject=f,d)}()})),window.addEventListener("output.mute",(e=>{d&&o(4,d.muted=!0,d)})),window.addEventListener("output.unmute",(e=>{d&&o(4,d.muted=!1,d)})),window.addEventListener("voiceMessage",(e=>{const t=JSON.parse(e.data).type;JSON.parse(e.data).body.from_uuid==g.uuid&&("act_start"==t?o(5,$=!0):"act_stop"==t&&o(5,$=!1))})),y.subscribe((e=>{d&&o(4,d.volume=e,d)})),t.$$set=e=>{"peer"in e&&o(6,m=e.peer),"player"in e&&o(0,g=e.player),"me"in e&&o(1,h=e.me),"selectedOutput"in e&&o(7,x=e.selectedOutput),"volume"in e&&c(o(2,y=e.volume)),"mutedOutput"in e&&l(o(3,w=e.mutedOutput)),"hearingDistance"in e&&o(8,b=e.hearingDistance)},t.$$.update=()=>{if(8208&t.$$.dirty&&d&&o(4,d.muted=i,d),6417&t.$$.dirty&&g&&v!==g.hearing&&(o(11,v=g.hearing),d&&!1!==g.hearing)){let e=(b-g.hearing)/b,t=(e>1?1:e)*r;(t>1||t<0||!t)&&(t=1),console.log(),o(4,d.volume=t,d)}if(1539&t.$$.dirty&&h.stream&&g.uuid==h.uuid&&(o(10,f=h.stream),!p)){let e=new AudioContext,t=e.createMediaStreamSource(f),n=e.createScriptProcessor(2048,1,1);t.connect(n),n.connect(e.destination),n.onaudioprocess=_,h.selectedMicrophone.subscribe((o=>{try{t=e.createMediaStreamSource(f),t.connect(n),n.connect(e.destination)}catch(e){console.log(e)}}))}},[g,h,y,w,d,$,m,x,b,p,f,v,r,i,function(e){D[e?"unshift":"push"]((()=>{d=e,o(4,d),o(13,i),o(0,g),o(11,v),o(8,b),o(12,r)}))}]}class xe extends X{constructor(e){super(),W(this,e,he,ge,i,{peer:6,player:0,me:1,selectedOutput:7,volume:2,mutedOutput:3,hearingDistance:8})}}let ye=new XMLHttpRequest;ye.open("GET","/config.json",!1),ye.send();let we=ye.responseText;console.log(we);const be=JSON.parse(we),ve={iceServers:[be.turn,be.stun]};console.log(ve),RTCPeerConnection=window.RTCPeerConnection||window.webkitRTCPeerConnection;class $e extends RTCPeerConnection{constructor(e,t,n){super(ve),this.uuid=t,this.websockets=n,this.sent=!1,this.stream=new MediaStream,this.remoteStream=new MediaStream,this.ontrack=e=>{this.remoteStream.addTrack(e.track)},console.log(this.configuration),this.onicecandidateerror=e=>{console.log(e)},console.log(this.connectionState),this.onconnectionstatechange=()=>console.log(this.connectionState),this.onicecandidate=e=>{n.voice.send(JSON.stringify({type:"candidate",candidate:e.candidate,to_uuid:t}))}}}function ke(e,t,n){const o=e.slice();return o[30]=t[n],o[32]=n,o}function _e(t){let n,o,r,s,c,u,a,l=t[3],h=Se(t),y=t[8],w=[];for(let e=0;e<y.length;e+=1)w[e]=De(ke(t,y,e));const v=e=>B(w[e],1,1,(()=>{w[e]=null}));return u=new ae({props:{volume:t[13],mutedOutput:t[15],stream:t[3],microphones:t[6],selectedMicrophone:t[12],selectedOutput:t[14],outputs:t[5],muted:t[11],players:t[7],websockets:t[4]}}),{c(){n=g("span"),n.textContent="Nearby players",o=x(),r=g("div"),h.c(),s=x();for(let e=0;e<w.length;e+=1)w[e].c();c=x(),H(u.$$.fragment),b(n,"class","text-[#fff] w-full text-[48px] font-[400] mt-[50px]"),k(n,"text-align","center"),b(r,"class","flex justify-center items-center w-full h-full mb-[50px] mt-[50px] players svelte-1fybq89"),k(r,"overflow","auto")},m(e,t){p(e,n,t),p(e,o,t),p(e,r,t),h.m(r,null),d(r,s);for(let e=0;e<w.length;e+=1)w[e].m(r,null);p(e,c,t),q(u,e,t),a=!0},p(t,n){if(8&n[0]&&i(l,l=t[3])?(R(),B(h,1,1,e),F(),h=Se(t),h.c(),z(h,1),h.m(r,s)):h.p(t,n),57730&n[0]){let e;for(y=t[8],e=0;e<y.length;e+=1){const o=ke(t,y,e);w[e]?(w[e].p(o,n),z(w[e],1)):(w[e]=De(o),w[e].c(),z(w[e],1),w[e].m(r,null))}for(R(),e=y.length;e<w.length;e+=1)v(e);F()}const o={};8&n[0]&&(o.stream=t[3]),64&n[0]&&(o.microphones=t[6]),32&n[0]&&(o.outputs=t[5]),128&n[0]&&(o.players=t[7]),16&n[0]&&(o.websockets=t[4]),u.$set(o)},i(e){if(!a){z(h);for(let e=0;e<y.length;e+=1)z(w[e]);z(u.$$.fragment,e),a=!0}},o(e){B(h),w=w.filter(Boolean);for(let e=0;e<w.length;e+=1)B(w[e]);B(u.$$.fragment,e),a=!1},d(e){e&&f(n),e&&f(o),e&&f(r),h.d(e),m(w,e),e&&f(c),G(u,e)}}}function Oe(t){let n;return{c(){n=g("span"),n.textContent="Disconnected",b(n,"class","text-[#ed4245] w-full text-[48px] font-[600]';"),k(n,"text-align","center")},m(e,t){p(e,n,t)},p:e,i:e,o:e,d(e){e&&f(n)}}}function Se(e){let t,n;return t=new xe({props:{volume:e[13],me:{uuid:e[2],stream:e[3],websockets:e[4],selectedMicrophone:e[12],mute:e[10],deaf:e[9]},player:{uuid:e[2]}}}),{c(){H(t.$$.fragment)},m(e,o){q(t,e,o),n=!0},p(e,n){const o={};1564&n[0]&&(o.me={uuid:e[2],stream:e[3],websockets:e[4],selectedMicrophone:e[12],mute:e[10],deaf:e[9]}),4&n[0]&&(o.player={uuid:e[2]}),t.$set(o)},i(e){n||(z(t.$$.fragment,e),n=!0)},o(e){B(t.$$.fragment,e),n=!1},d(e){G(t,e)}}}function De(e){let t,n;return t=new xe({props:{volume:e[13],hearingDistance:e[1],players:e[7],peer:e[30],selectedOutput:e[14],player:e[30],mutedOutput:e[15]}}),{c(){H(t.$$.fragment)},m(e,o){q(t,e,o),n=!0},p(e,n){const o={};2&n[0]&&(o.hearingDistance=e[1]),128&n[0]&&(o.players=e[7]),256&n[0]&&(o.peer=e[30]),256&n[0]&&(o.player=e[30]),t.$set(o)},i(e){n||(z(t.$$.fragment,e),n=!0)},o(e){B(t.$$.fragment,e),n=!1},d(e){G(t,e)}}}function Ee(e){let t,n,o,r,i,s,c,a,l,m,h,y,w,v,$,k,_;const O=[Oe,_e],S=[];function D(e,t){return e[0]?0:1}return $=D(e),k=S[$]=O[$](e),{c(){t=g("div"),n=g("img"),r=x(),i=g("img"),c=x(),a=g("img"),m=x(),h=g("img"),w=x(),v=g("div"),k.c(),u(n.src,o="/images/dots1.png")||b(n,"src","/images/dots1.png"),b(n,"class","bottom-[-5px] left-[-5px] fixed"),b(n,"alt",""),u(i.src,s="/images/dots2.png")||b(i,"src","/images/dots2.png"),b(i,"class","top-[0px] right-[405px] fixed"),b(i,"alt",""),u(a.src,l="/images/dots3.png")||b(a,"src","/images/dots3.png"),b(a,"class","top-[260px] right-[-5px] fixed"),b(a,"alt",""),u(h.src,y="/images/logo.png")||b(h,"src","/images/logo.png"),b(h,"class","fixed"),b(h,"alt",""),b(v,"class","flex flex-col relative w-[900px] h-[100vh] justify-center"),b(t,"class","flex justify-center items-center w-full h-[100vh] relative")},m(e,o){p(e,t,o),d(t,n),d(t,r),d(t,i),d(t,c),d(t,a),d(t,m),d(t,h),d(t,w),d(t,v),S[$].m(v,null),_=!0},p(e,t){let n=$;$=D(e),$===n?S[$].p(e,t):(R(),B(S[n],1,1,(()=>{S[n]=null})),F(),k=S[$],k?k.p(e,t):(k=S[$]=O[$](e),k.c()),z(k,1),k.m(v,null))},i(e){_||(z(k),_=!0)},o(e){B(k),_=!1},d(e){e&&f(t),S[$].d()}}}async function Me(e,t){t.stream=e.clone(),t.stream.getTracks().forEach((async e=>{e.enabled=!1,await t.addTrack(e,t.stream)}))}function Ne(e,t,n){let o,r,i,s,c=!1,u=10;const a=new URLSearchParams(window.location.search);let d=Q(!1);function p(){for(let e of o)e.close();try{g.send(JSON.stringify({type:"disconnect"}))}catch(e){}n(0,c=!0)}l(e,d,(e=>n(10,i=e))),d.subscribe((e=>{}));let f,m,g,h,x,y=a.get("token"),w=[],b=Q();l(e,b,(e=>n(21,s=e)));let v=Q(1),$=Q(),k=Q(!1);l(e,k,(e=>n(9,r=e)));let _=[],S=be.server;async function D(){try{return await navigator.mediaDevices.getUserMedia({audio:{deviceId:s.deviceId}})}catch(e){return alert("Please accept"),await D()}}"current"==S&&(S=`${window.location.protocol}//${window.location.host}`),b.subscribe((async e=>{if(e){n(3,m=await D());for(let e of o){let t=m.getAudioTracks()[0],n=e.getSenders().find((e=>"audio"==e.track.kind));n.replaceTrack(t)}}})),O((async e=>{n(6,_=await async function(){let e=[];for(let t of await navigator.mediaDevices.enumerateDevices())"audioinput"==t.kind&&e.push(t);return e}()),n(5,w=await async function(){let e=[];for(let t of await navigator.mediaDevices.enumerateDevices())"audiooutput"==t.kind&&e.push(t);return e}()),b.set(_[0]),$.set(w[0]),n(3,m=await D());let t=await fetch(`${S}/voice/?token=`+y,{method:"GET"});if(t.ok){let e=await t.json();n(2,f=e.uuid),await async function(){n(17,h=new WebSocket(`${M}voice/ws/player/data/?token=`+y)),n(16,g=new WebSocket(`${M}voice/ws/player/voice/?token=`+y)),n(17,h.onclose=()=>p(),h),n(16,g.onclose=()=>p(),g),n(16,g.onmessage=e=>{let t=new Event("voiceMessage");t.data=e.data,JSON.parse(e.data).body.from_uuid!=f&&dispatchEvent(t)},g),n(16,g.onopen=()=>{g.send(JSON.stringify({type:"join"}))},g),n(17,h.onmessage=e=>{let t=new Event("dataMessage");t.data=e.data,dispatchEvent(t)},h)}()}else 404==t.status&&(alert("player not found, please reload page"),p())}));let E="ws";S.includes("https://")&&(E="wss");let M=`${E}://${S.replaceAll("https://","").replaceAll("http://","")}/`;function N(e){e.onconnectionstatechange=()=>{"disconnected"!=e.connectionState&&"failed"!=e.connectionState||T.remove(e)}}window.addEventListener("dataMessage",(e=>{const t=JSON.parse(e.data).type,o=JSON.parse(e.data).data;if("distance_update"==t){const e=o.distance;n(1,u=o.hearingDistance);for(let t of Object.keys(e)){let n=T.get(t);if(n){n.hearing=e[t];let o=n.stream;e[t]?o.getTracks()[0].enabled=!i:o.getTracks()[0].enabled=!1,T.update((e=>(e[e.indexOf(n)]=n,e)))}}}else if("player_disconnect"==t)p(),h.close(),g.close();else if("disconnect"==t){let e=T.get(o.from_uuid);e&&(e.close(),T.remove(e))}})),window.addEventListener("voiceMessage",(async e=>{const t=JSON.parse(e.data).type,n=JSON.parse(e.data).body;if("join"==t){T.get(n.from_uuid)&&T.remove(n.from_uuid);let e=new $e({},n.from_uuid,x);N(e),await Me(m,e);let t=await e.createOffer();await e.setLocalDescription(t),g.send(JSON.stringify({type:"offer",offer:e.localDescription,to_uuid:n.from_uuid})),T.push(e)}else if("offer"==t&&n.to_uuid==f){T.get(n.from_uuid)&&T.remove(n.from_uuid);let e=new $e({},n.from_uuid,x);N(e),await Me(m,e),e.remoteDescription||await e.setRemoteDescription(new RTCSessionDescription(n.offer));let t=await e.createAnswer();e.localDescription||await e.setLocalDescription(t),g.send(JSON.stringify({type:"answer",answer:e.localDescription,to_uuid:n.from_uuid})),T.push(e),g.send(JSON.stringify({type:"change_state",states:{mute:i,deaf:r}}))}else if("answer"==t&&n.to_uuid==f){let e=T.get(n.from_uuid);if(!e)return;e.remoteDescription||e.setRemoteDescription(new RTCSessionDescription(n.answer)),g.send(JSON.stringify({type:"change_state",states:{mute:i,deaf:r}}))}else if("candidate"==t&&n.to_uuid==f){let e=T.get(n.from_uuid);if(!n.candidate)return;if(!e)return;e.addIceCandidate(new RTCIceCandidate(n.candidate)).catch((t=>T.remove(e))).catch((e=>{console.log(n.candidate,"err")}))}else if("disconnect"==t){let e=T.get(n.from_uuid);e&&(e.close(),T.remove(e))}else if("change_state"==t){let e=T.get(n.from_uuid);e&&("mute"in n&&(e.mute=n.mute),"deaf"in n&&(e.deaf=n.deaf),T.update((t=>{let n=t.indexOf(e);return t[n]=e,t})))}}));let T=Q([]);return l(e,T,(e=>n(8,o=e))),T.push=e=>{T.update((t=>(t.push(e),t)))},T.remove=e=>{T.update((t=>{const n=t.indexOf(e);return n>-1&&t.splice(n,1),t}))},T.get=e=>{let t=o.filter((t=>t.uuid==e));return t.length>0?t[0]:null},window.onbeforeunload=()=>{p()},e.$$.update=()=>{196608&e.$$.dirty[0]&&n(4,x={voice:g,data:h})},[c,u,f,m,x,w,_,T,o,r,i,d,b,v,$,k,g,h]}return new class extends X{constructor(e){super(),W(this,e,Ne,Ee,i,{},null,[-1,-1])}}({target:document.body,props:{name:"world"}})}();
//# sourceMappingURL=bundle.js.map
